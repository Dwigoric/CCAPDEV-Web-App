import{_ as ue}from"./donut_love-8c13c53b.js";import{_ as H,B as J,E as me,n as V,o as a,c as f,a as m,b as s,w as i,q as w,G as ce,H as d,D as L,J as N,d as c,K as pe,v as h,x as A,m as Y,L as Z,M as R,O as F,P as ee,t as v,Q as G,R as te,s as fe,S as U,y as ye,z as ve,U as oe,W as ne,A as T,X as q,Y as O,Z as W,F as M,$ as se,a0 as K,a1 as ge,a2 as ke,r as we,a3 as Ce,N as $e,a4 as X,T as he}from"./index-0034d016.js";const be={class:"post"},Ve={class:"user"},Pe={class:"user-name"},xe={class:"content"},Se={key:0,class:"title",id:"title"},Ie={key:1,class:"body",id:"body"},qe=["src","alt"],Be={__name:"PostSpecific",props:{post:{type:Object,required:!0,id:{type:String,required:!0},title:{type:String,required:!0},body:{type:String,required:!0},image:{type:String,required:!1},edited:{type:Number,required:!1,default:null},deleted:{type:Boolean,required:!1,default:!1},user:{type:Object,required:!0,image:{type:String,required:!1}}},savePost:{type:Function,required:!0},deletePost:{type:Function,required:!0}},setup(e){const l=e,P=J(),{cachedPosts:C}=me(),b=V(l.post.title),y=V(l.post.body),g=V(!1),u=V(null),x=[$=>!!$||"Title is required"],_=[$=>!!$||"Body is required"];function I(){l.deletePost(l.post.id),C.splice(C.findIndex($=>$.id===l.post.id),1),L.push({name:"feed"})}function B(){g.value=!0}async function E(){const{valid:$}=await u.value.validate();if(!$)return;g.value=!1;const t=C.find(o=>o.id===l.post.id);t&&(t.title=b.value,t.body=y.value,t.edited=Date.now()),l.savePost({title:b.value,body:y.value})}return($,t)=>(a(),f("div",be,[m("div",Ve,[s(pe,{class:"user-image"},{default:i(()=>[e.post.deleted?(a(),w(N,{key:1},{default:i(()=>t[5]||(t[5]=[c("mdi-account-remove")])),_:1})):(a(),w(ce,{key:0,src:e.post.user.image,alt:`${e.post.user.username}'s image`,onClick:t[0]||(t[0]=o=>d(L).push({name:"profile",params:{username:e.post.user.username}}))},null,8,["src","alt"]))]),_:1}),m("span",Pe,h(e.post.user.username),1),d(P).id===e.post.user.id?(a(),w(ee,{key:0},{activator:i(({props:o})=>[s(A,Y(o,{size:"large",density:"compact",variant:"text",icon:"mdi-dots-vertical",class:"ml-5"}),null,16)]),default:i(()=>[s(Z,null,{default:i(()=>[s(R,{onClick:B},{default:i(()=>[s(F,null,{default:i(()=>t[6]||(t[6]=[c("Edit")])),_:1})]),_:1}),s(R,{onClick:I},{default:i(()=>[s(F,null,{default:i(()=>t[7]||(t[7]=[c("Delete")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0),s(G),d(te)("(min-width: 1024px)").value?(a(),w(A,{key:1,variant:"text",size:"large",density:"compact",onClick:t[1]||(t[1]=o=>d(L).push({name:"feed"}))},{default:i(()=>[t[9]||(t[9]=c(" Go Back ")),s(N,null,{default:i(()=>t[8]||(t[8]=[c("mdi-arrow-left-circle")])),_:1})]),_:1})):v("",!0)]),m("div",xe,[g.value?v("",!0):(a(),f("p",Se,h(e.post.title),1)),g.value?v("",!0):(a(),f("p",Ie,h(e.post.body),1)),s(ve,{onSubmit:t[4]||(t[4]=ye(()=>{},["prevent"])),ref_key:"form",ref:u},{default:i(()=>[g.value?(a(),w(fe,{key:0,modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=o=>b.value=o),rules:x,"validate-on":"input lazy",placeholder:"Enter new title..."},null,8,["modelValue"])):v("",!0),g.value?(a(),w(U,{key:1,modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=o=>y.value=o),rules:_,"validate-on":"input lazy",placeholder:"What's up?","no-resize":""},null,8,["modelValue"])):v("",!0),g.value?(a(),w(A,{key:2,type:"submit",onClick:E},{default:i(()=>t[10]||(t[10]=[c("Save")])),_:1})):v("",!0)]),_:1},512),e.post.image?(a(),f("img",{key:2,class:"post-image",src:e.post.image,alt:`An image in ${l.post.user.username}'s post`},null,8,qe)):v("",!0)])]))}},ze=H(Be,[["__scopeId","data-v-e9219dd9"]]),D=oe([]),ae=ne("comments",()=>({comments:D,async addComment(e){if(e.body)try{const{token:l}=window.$cookies.get("credentials"),{comment:P,error:C,message:b}=await fetch(`${T}/comments/${e.postId}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(e)}).then(y=>y.json());if(C){console.error(b);return}D.push({...P,date:Date.now()})}catch(l){console.error(l)}},clearComments(){D.splice(0,D.length)}})),ie=V(null),re=ne("currentComment",()=>({currentComment:ie,setCurrentComment:Te}));function Te(e){ie.value=e}const _e={class:"comment ml-4"},Ne={key:0,class:"existing-comment"},Ee={class:"header mx-3 mt-2"},je=["src","alt"],Le={class:"user-name"},De={class:"time-span ml-2"},Ae={key:0,class:"time-span ml-2"},Re={class:"content mx-3 mt-1 mb-2"},Fe={key:0,class:"body"},Ue={key:1,class:"deleted-comment"},Oe={class:"replies"},Me={__name:"PostComment",props:{id:{type:String,required:!0},postId:{type:String,required:!0},user:{type:Object,required:!0},body:{type:String,required:!0},date:{type:Number,required:!0},edited:{type:Number,required:!1},onclick:{type:Function,required:!1}},setup(e){const l=J(),{comments:P,addComment:C}=ae(),b=re(),y=e,g=V(""),u=V(y.body),x=V(!1),_=[t=>t.length<=500||"Comment must be less than 500 characters"];function I(t){C({postId:y.postId,body:g.value,parentCommentId:t}),g.value=""}async function B(){try{const{token:t}=window.$cookies.get("credentials"),o=await fetch(`${T}/comments/${y.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}).then(z=>z.json());if(o.error){console.error(o.error);return}const n=P.find(z=>z.id===y.id);n.deleted=!0,n.body="[deleted]",n.user=null}catch(t){console.error(t)}}function E(){x.value=!0}async function $(){if(x.value=!1,u.value===""||u.value===y.body)return;const{token:t}=window.$cookies.get("credentials");try{const n=await fetch(`${T}/comments/${y.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({body:u.value})}).then(z=>z.json());n.error&&console.error(n.message)}catch(n){console.error(n)}const o=P.find(n=>n.id===y.id);o.body=u.value,o.edited=Date.now()}return(t,o)=>(a(),f("div",_e,[m("div",{class:"main-comment",onClick:o[2]||(o[2]=n=>e.onclick(e.id))},[d(P).some(n=>n.id===e.id&&n.deleted)?(a(),f("span",Ue," This comment has been deleted ")):(a(),f("div",Ne,[m("div",Ee,[m("img",{class:"user-image",src:e.user.image,alt:`${e.user.username}'s image`,onClick:o[0]||(o[0]=n=>d(L).push({name:"profile",params:{username:e.user.username}}))},null,8,je),m("span",Le,h(e.user.username),1),m("span",De,[s(N,{size:"x-small"},{default:i(()=>o[6]||(o[6]=[c(" mdi-clock ")])),_:1}),c(" "+h(d(q)(e.date).fromNow())+" ",1),s(O,{activator:"parent",location:"top"},{default:i(()=>[c(" created at "+h(d(q)(e.date)),1)]),_:1}),o[7]||(o[7]=m("span",{class:"time-span"},null,-1))]),e.edited?(a(),f("span",Ae,[s(N,{size:"x-small"},{default:i(()=>o[8]||(o[8]=[c(" mdi-pencil ")])),_:1}),c(" "+h(d(q)(e.edited).fromNow())+" ",1),s(O,{activator:"parent",location:"top"},{default:i(()=>[c(" edited at "+h(d(q)(e.edited)),1)]),_:1})])):v("",!0)]),m("div",Re,[x.value?(a(),w(d(U),{key:1,class:"new-reply-input",variant:"solo-filled","auto-grow":"auto-grow",modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=n=>u.value=n),placeholder:"Enter a new comment...",rules:_,rows:"1",cols:"50","no-resize":"no-resize","append-inner-icon":"mdi-send","onClick:appendInner":$},null,8,["modelValue"])):(a(),f("p",Fe,h(e.body),1))])])),e.user&&d(l).id===e.user.id?(a(),w(ee,{key:2},{activator:i(({props:n})=>[s(A,Y({class:"ml-3 mr-2"},n,{size:"large",density:"compact",variant:"text",icon:"mdi-dots-vertical"}),null,16)]),default:i(()=>[s(Z,null,{default:i(()=>[s(R,{onClick:E},{default:i(()=>[s(F,null,{default:i(()=>o[9]||(o[9]=[c("Edit")])),_:1})]),_:1}),s(R,{onClick:B},{default:i(()=>[s(F,null,{default:i(()=>o[10]||(o[10]=[c("Delete")])),_:1})]),_:1})]),_:1})]),_:1})):v("",!0)]),s(W,null,{default:i(()=>[d(l).username&&e.id===d(b).currentComment?(a(),w(G,{key:0,class:"reply-input-spacer"})):v("",!0)]),_:1}),s(W,null,{default:i(()=>[d(l).username&&e.id===d(b).currentComment?(a(),w(d(U),{key:0,placeholder:"Reply to this comment...",class:"new-reply-input px-3",active:"true",variant:"solo-filled","auto-grow":"auto-grow",clearable:"clearable",modelValue:g.value,"onUpdate:modelValue":o[3]||(o[3]=n=>g.value=n),"no-resize":"",rules:_,rows:"1","append-inner-icon":"mdi-send","onClick:appendInner":o[4]||(o[4]=n=>I(e.id)),"prepend-inner-icon":"mdi-menu-up","onClick:prependInner":o[5]||(o[5]=n=>d(b).setCurrentComment(null))},null,8,["modelValue"])):v("",!0)]),_:1}),m("div",Oe,[(a(!0),f(M,null,se(d(P).filter(n=>n.parentCommentId===e.id),n=>(a(),w(de,{key:n.id,id:n.id,"post-id":e.postId,user:n.user,body:n.body,date:n.date,edited:n.edited,onclick:e.onclick},null,8,["id","post-id","user","body","date","edited","onclick"]))),128))])]))}},de=H(Me,[["__scopeId","data-v-ad62110b"]]);const He={id:"view"},Je={key:0,class:"preload"},Ge={key:1,class:"preload"},Qe={key:2,id:"post-details"},We={id:"post-info"},Ke={key:0,class:"time-span ml-5"},Xe={class:"time-span ml-2 mr-3"},Ye={key:0,id:"new-comment"},Ze={id:"comments"},et={key:0,id:"loader-wrapper"},tt={__name:"PostView",props:{id:{type:String,required:!0}},setup(e){const l=e,P=J(),{comments:C,addComment:b,clearComments:y}=ae(),g=re();document.title="Compact Donuts | Post";const u=oe({id:l.id,title:"",body:"",image:"",reactions:0,date:null,edited:null,user:{id:"",username:"",image:""}}),x=V(""),_=V(""),I=V(!0),B=V(!0),E=[p=>p.length<=500||"Comment must be less than 500 characters"];async function $(){try{const{post:p,error:r}=await fetch(`${T}/posts/${l.id}`).then(S=>S.json());if(r){I.value=!1;return}Object.assign(u,p)}catch(p){console.error(p)}I.value=!1}async function t(){try{const{comments:p}=await fetch(`${T}/comments/${l.id}`).then(r=>r.json());C.splice(0,C.length,...p)}catch(p){console.error(`Error occurred while fetching comments for post with ID ${l.id}:`,p),C.splice(0,C.length)}B.value=!1}const o=()=>{b({postId:l.id,body:x.value,parentCommentId:null}),x.value=""};async function n({title:p,body:r}){const S={};let k=!1;if(p!==l.title&&(u.title=p,S.title=p,k=!0),r!==l.body&&(u.body=r,S.body=r,k=!0),!!k){u.edited=Date.now();try{const{token:j}=window.$cookies.get("credentials"),Q=await fetch(`${T}/posts/${u.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(S)}).then(le=>le.json());Q.error&&console.error(Q.error)}catch(j){console.error(j)}}}async function z(){try{const{token:p}=window.$cookies.get("credentials"),r=await fetch(`${T}/posts/${u.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${p}`}}).then(S=>S.json());r.error&&console.error(r.error)}catch(p){console.error(p)}return L.push({name:"feed"})}return K($),K(t),ge(y),ke(()=>l.id,()=>{I.value=!0,B.value=!0,y(),$(),t()}),(p,r)=>{const S=we("RouterLink");return a(),f(M,null,[d(te)("(min-width: 1024px)").value?(a(),w(he,{key:0})):v("",!0),s($e,{"title-custom-text":"Back to Feed"}),m("div",He,[I.value?(a(),f("div",Je,[s(X)])):u.title===""?(a(),f("div",Ge,[r[2]||(r[2]=m("img",{src:ue,alt:"404",id:"logo"},null,-1)),r[3]||(r[3]=m("h1",null,"404",-1)),r[4]||(r[4]=m("h2",null,"Post not found",-1)),r[5]||(r[5]=m("p",null,"The post you are looking for does not exist.",-1)),s(S,{to:"/feed"},{default:i(()=>r[1]||(r[1]=[m("span",null," Back to feed ",-1)])),_:1})])):(a(),f("div",Qe,[s(ze,{post:u,"save-post":n,"delete-post":z},null,8,["post"]),m("div",We,[s(Ce,{id:e.id},null,8,["id"]),s(G),u.edited?(a(),f("span",Ke,[s(N,{size:"x-small"},{default:i(()=>r[6]||(r[6]=[c(" mdi-pencil ")])),_:1}),c(" edited "+h(d(q)(u.edited).fromNow())+" ",1),s(O,{activator:"parent",location:"top"},{default:i(()=>[c(" edited at "+h(d(q)(u.edited)),1)]),_:1})])):v("",!0),m("span",Xe,[s(N,{size:"x-small"},{default:i(()=>r[7]||(r[7]=[c(" mdi-clock ")])),_:1}),c(" posted "+h(d(q)(u.date).fromNow())+" ",1),s(O,{activator:"parent",location:"top"},{default:i(()=>[c(" posted at "+h(d(q)(u.date)),1)]),_:1})])]),d(P).username?(a(),f("div",Ye,[s(U,{placeholder:"Add a comment...",id:"new-comment-body",active:"true","no-resize":"no-resize",variant:"solo-filled","auto-grow":"auto-grow",clearable:"clearable",rules:E,rows:"1",modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=k=>x.value=k),"append-inner-icon":"mdi-send","onClick:appendInner":o},null,8,["modelValue"])])):v("",!0),m("div",Ze,[B.value?(a(),f("div",et,[s(X)])):(a(!0),f(M,{key:1},se(d(C).filter(k=>k.parentCommentId===null),k=>(a(),w(de,{key:k.id,id:k.id,"post-id":e.id,body:k.body,user:k.user,depth:0,date:k.date,edited:k.edited,onclick:j=>{d(g).setCurrentComment(j),_.value=""}},null,8,["id","post-id","body","user","date","edited","onclick"]))),128))])]))])],64)}}},st=H(tt,[["__scopeId","data-v-baed5144"]]);export{st as default};
